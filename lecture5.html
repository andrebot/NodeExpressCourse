<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Node.js - Lecture 5</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
    <script type="text/javascript">
      function toggleCode(id) {
        var $element = $(id);
        if ($element.is(':visible')) {
          $(id).slideUp();
        } else {
          $(id).slideDown();
        }

      }
    </script>

		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>

		<style>
			.ac-caption {
				margin: 5px 0px 10px 0px;
				font-size: 13px;
  				text-align: center;
			}

			#header > nav ul li a {
				padding: 0px;
				font-size: 0.8em;
			}

			#one:before {
				background-image: none;
				height: 0em;
			}

			header.major h2 {
				line-height: 1em;
			}

      .hidden-code {
        margin-bottom: 10px;
      }

      .hidden-code .title {
        font-weight: bold;
        margin-bottom: 5px;
        cursor: pointer;
      }

      .hidden {
        display: none;
      }
		</style>

		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>
		<div id="wrapper">

			<!-- Header -->
				<section id="header" class="skel-layers-fixed">
					<header>

						<h1 id="logo"><a href="#">Node.js - Lecture 4</a></h1>

					</header>
					<nav id="nav">
						<ul>
							<li><a href="#one" class="active">Gulp</a></li>
							<li><a href="#two">Test</a></li>
              <li><a href="#six">Exercises</a></li>
						</ul>
						<img src="images/ac-logo.png" alt="">
					</nav>
					<footer>
					</footer>
				</section>

			<!-- Main -->
				<div id="main">

					<!-- One -->
          <section id="one">
            <div class="container">
              <header class="major">
                <h2>Gulp</h2>
              </header>

              <header>
                <h4>What is Gulp?</h4>
              </header>

              <p align="justify">
                <i>
                  "Gulp is a tool for task automation in Node."
                </i>
                <p align="right">- <a href="https://www.facebook.com/pedroboi?fref=ts">Dias, Pedro</a></p>
              </p>

              <p align="justify">
                Pedro is right! Gulp is a excellent tool to have in your projects! All of them! No exceptions! Use it!
                If you don't know, this is the time to learn it! It is very powerful. When I started stu<b>dying</b> Node
                I got confused! There is lot to learn! I was afraid to look into one more tool of this huge stack because
                it seemed hard and awkward. I couldn't see the benefits of it, I could do everything myself. But once I
                learned it I saw the light.
              </p>

              <p align="justify">
                Why use it? So you can automate all the little boring tasks that you have to do on your code every day.
                Just to name a few:
              </p>

              <ul>
                <li>Compile a distribution version;</li>
                <li>Concatenate, uglify, minify CSS/JS files;</li>
                <li>Bounce server after changes;</li>
                <li>Run tests;</li>
                <li>Run coverage tool;</li>
                <li>Move files around;</li>
                <li>Install libraries;</li>
                <li>Make Coffee.</li>
              </ul>

              <p align="justify">
                And those ones are just the ones that came up in my mind right now, we have a bunch of community plugins
                for us to use, and they keep growing. Non-stop. Seriously, it is non stop, it is kind of crazy.
              </p>

              <header>
                <h4>Gulpfile</h4>
              </header>

              <p align="justify">
                Now that I've built into your soul that Gulp is cool lets start understanding how it works: First, we
                need to install it:
              </p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">npm</span> <span style="color: #a6e22e">install</span> <span style="color: #a6e22e">gulp</span> <span style="color: #f92672">--</span><span style="color: #a6e22e">save</span><span style="color: #f92672">-</span><span style="color: #a6e22e">dev</span>
</pre></div>

              <div class="ac-caption">Installing Gulp</div>

              <p align="justify">
                We are already all set to go. We have Gulp installed. Now we have to tell Gulp what he can do. To do
                that we need to create a file named <i>gulpfile.js</i> in our root folder (This file must be named this
                way, Gulp will look for this file once executed).
              </p>

              <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
              <pre style="margin: 0; line-height: 125%">
                <span style="color: #d0d0d0">└── nodeCode</span>
                <span style="color: #d0d0d0">    ├── src</span>
                <span style="color: #d0d0d0">    ├── package.json</span>
                <span style="color: #d0d0d0">    └── gulpfile.js</span>
              </pre>
              </div>
              <div class="ac-caption">gulpfile.js In The Root Folder</div>

              <p align="justify">
                Ok, we have to know what to add to this new file of ours. First lets take a look into what this file
                should have inside.
              </p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #e6db74">&#39;use strict&#39;</span><span style="color: #f8f8f2">;</span>

<span style="color: #75715e">//imports</span>
<span style="color: #66d9ef">const</span> <span style="color: #a6e22e">gulp</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;gulp&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">gulp</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">task</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;default&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">()</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #75715e">//...</span>
<span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">gulp</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">task</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;task2&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">()</span> <span style="color: #f92672">=&gt;</span> 
  <span style="color: #75715e">//...</span>
<span style="color: #f8f8f2">);</span>
</pre></div>

              <div class="ac-caption">Glance At a Gulpfile</div>

              <p align="justify">
                Here we can see how Gulp works. With this configuration I can execute Gulp using NPM, adding new commands under
                the "script" attribute in package.json. I have two tasks configured, <i>default</i> and <i>task1</i>. To execute a 
                task with gulp you have to do this syntax:
              </p>

              <!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">gulp</span> <span style="color: #f92672">&lt;</span><span style="color: #a6e22e">task_name</span><span style="color: #f92672">&gt;</span>
</pre></div>

              <div class="ac-caption">Executing a gulp task</div>

              <p align="justify">
                However, everything under the <i>default</i> task will be executed without the need of naming it, meaning that I can
                execute:
              </p>

              <!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">gulp</span>
</pre></div>

              <div class="ac-caption">Executing default task</div>

              <p align="justify">
                And the task <i>default</i> will be run. Neat, right?
              </p>

              <p align="justify">
                As you can see Gulp uses a code syntax to configure its tasks. This way, if you want to use any other package or
                module, you just need to install it with NPM and import it using <b>require</b>. For instance, if I want to
              </p>

              <header>
                <h4>Running a Task</h4>
              </header>

              <p align="justify">
                Enough talk. First thing, lets get right of this cursed task that is to bounce our server every time we
                do some changes. Lets automate it. First, we will install <a href="http://nodemon.io/">nodemon</a>. However,
                we need nodemon for <b>Grunt</b> which can be found at <a href="https://github.com/ChrisWren/grunt-nodemon">grunt-nodemon</a>.
              </p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">npm</span> <span style="color: #a6e22e">install</span> <span style="color: #a6e22e">grunt</span><span style="color: #f92672">-</span><span style="color: #a6e22e">nodemon</span> <span style="color: #f92672">--</span><span style="color: #a6e22e">save</span><span style="color: #f92672">-</span><span style="color: #a6e22e">dev</span>
</pre></div>

              <div class="ac-caption">Installing Nodemon For Grunt</div>

              <p align="justify">
                Now that it is installed we will configure <b>nodemon</b> to watch and bounce our server once it is
                changed:
              </p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">module</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">exports</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">initConfig</span><span style="color: #f8f8f2">({</span>
    <span style="color: #a6e22e">nodemon</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">express</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">script</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;index.js&#39;</span><span style="color: #f8f8f2">,</span>
        <span style="color: #a6e22e">options</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">watch</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;./&#39;</span><span style="color: #f8f8f2">],</span>
          <span style="color: #a6e22e">cwd</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;src&#39;</span>
        <span style="color: #f8f8f2">}</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">loadNpmTasks</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;grunt-nodemon&#39;</span><span style="color: #f8f8f2">);</span>

  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">registerTask</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;default&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;nodemon&#39;</span><span style="color: #f8f8f2">]);</span>
<span style="color: #f8f8f2">};</span>
</pre></div>

              <div class="ac-caption">Gruntfile with Nodemon</div>

							<p align="justify">
								Grunt is ready, although there is something we need to do if we want to execute Grunt tasks. We need to
								have a way to use it. Since we've installed <i>grunt-cli</i> and <i>grunt</i> locally we can use NPM
								to execute grunt.
							</p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">{</span>
  <span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;lecture5&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;version&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;1.0.0&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;description&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;index.js&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;scripts&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #e6db74">&quot;test&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;start&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;grunt&quot;</span>
  <span style="color: #f8f8f2">},</span>
  <span style="color: #e6db74">&quot;author&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;Andre Botelho&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;license&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;ISC&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">&quot;dependencies&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #e6db74">&quot;body-parser&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^1.15.1&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;cookie-parser&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^1.4.3&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;cors&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^2.7.1&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;express&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^4.13.4&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;jquery&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^3.1.0&quot;</span>
  <span style="color: #f8f8f2">},</span>
  <span style="color: #e6db74">&quot;devDependencies&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #e6db74">&quot;grunt&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^1.0.1&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;grunt-cli&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^1.2.0&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;grunt-nodemon&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;^0.4.2&quot;</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

							<div class="ac-caption">Addin script <b>start</b> to NPM scripts</div>

              <p align="justify">
                And finally we call <b>npm start</b> and run <b>grunt</b>. Pay attention that Gruntfile.js is in the root
								of your project. The task will be watching all changes on file ./src/index.js.
              </p>

							<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">npm</span> <span style="color: #a6e22e">start</span>
</pre></div>

              <div class="ac-caption">Executing Grunt With Nodemon using NPM</div>


              <p align="justify">
                Now we can change our server the way we like it! We have a bunch of cool packages to add and play with!
                Don't be shy and search for the really useful ones!
              </p>
            </div>
          </section>

          <!-- Two -->
          <section id="two">
            <div class="container">
              <header class="major">
                <h2>Unit Test</h2>
              </header>

              <header>
                <h4>Concept</h4>
              </header>

              <p align="justify">
                Unit testing. Yes, Unit testing. As usual lets take a look on what it means.
              </p>

              <p align="justify">
                <i>"In computer programming, unit testing is a software testing method by which individual units of source
                  code, sets of one or more computer program modules together with associated control data, usage procedures,
                  and operating procedures, are tested to determine whether they are fit for use."</i>
                <p align="right">- Wikipedia</p>
              </p>

              <p align="justify">
                Or other words, it is a code that tests your whole code by snippets that were defined as a testable units.
                You can test method by method, class by class, flow by flow, integration, you name it.
                And <b>Node</b> has some neat tools for testing. We can even test client-side application with it.
              </p>

              <p align="justify">
                Since we have to start from somewhere I will show you <b>Mocha</b> with
                <b>Grunt</b>. Yes, automated tests, baby!
              </p>

              <header>
                <h4>Tech Stack</h4>
              </header>

              <p align="justify">
                As we are building an API the stack that we will use is:
              </p>

              <ul>
                <li><a href="http://mochajs.org/">Mocha</a> for our test framework;</li>
                <li><a href="https://www.npmjs.com/package/should">Should</a> as our BDD assertion library;</li>
                <li><a href="https://www.npmjs.com/package/supertest">Supertest</a> as our library to make requests in the test environment;</li>
              </ul>

              <header>
                <h4>Configuring Gulp</h4>
              </header>

              <p align="justify">
                Everything should be installed with <b>NPM</b>, nice and easy. You can save those libraries with <i>--save-dev</i>.
                Installed everything? Go to go? NICE! Lets configure our gruntfile.
              </p>

             <!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #e6db74">&#39;use strict&#39;</span><span style="color: #f8f8f2">;</span>

<span style="color: #a6e22e">module</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">exports</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">initConfig</span><span style="color: #f8f8f2">({</span>
    <span style="color: #a6e22e">nodemon</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">express</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">script</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;server.js&#39;</span><span style="color: #f8f8f2">,</span>
        <span style="color: #a6e22e">options</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">watch</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;./&#39;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">}</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">},</span>
    <span style="color: #a6e22e">mochaTest</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">test</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">options</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">reporter</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;spec&#39;</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #a6e22e">src</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;tests/*.js&#39;</span><span style="color: #f8f8f2">]</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">},</span>
    <span style="color: #a6e22e">concurrent</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">test</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">tasks</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;nodemon:express&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;mochaTest&#39;</span><span style="color: #f8f8f2">],</span>
        <span style="color: #a6e22e">options</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
                <span style="color: #a6e22e">logConcurrentOutput</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">true</span>
            <span style="color: #f8f8f2">}</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">loadNpmTasks</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;grunt-nodemon&#39;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">loadNpmTasks</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;grunt-mocha-test&#39;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">loadNpmTasks</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;grunt-concurrent&#39;</span><span style="color: #f8f8f2">);</span>

  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">registerTask</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;default&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;nodemon:express&#39;</span><span style="color: #f8f8f2">]);</span>
  <span style="color: #a6e22e">grunt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">registerTask</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;testServer&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;mochaTest&#39;</span><span style="color: #f8f8f2">]);</span>
<span style="color: #f8f8f2">};</span>
</pre></div>

              <div class="ac-caption">Gruntfile With Nodemon and Mocha Configured</div>

              <p align="justify">
                Lets begin to explain: We've included the <i>mochaTest</i> task with two sub-tasks: <i>test</i>
                and <i>coverage</i>. First in the <i>test</i> sub-task, we defined two options inside <i>options</i>:
                <i>reporter</i> as "spec" (this is the default value that <b>grunt-mocha</b> adds for us without any explanation)
                and <i>require</i> as "blanketWrapper". This last one is for <b>Blanket</b> do its job and see how much of
                the code we've covered by the tests. <i>blanketWrapper</i> is the name of a file that we need to create
                to wrap <b>Blanket</b> inside <b>Mocha</b>'s <b>Grunt</b> task.
              </p>

              <!-- HTML generated using hilite.me -->
              <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">path</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;path&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">srcDir</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">path</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">join</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">__dirname</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;src&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;blanket&#39;</span><span style="color: #f8f8f2">)({</span>
  <span style="color: #75715e">// Only files that match the pattern will be instrumented</span>
  <span style="color: #a6e22e">pattern</span><span style="color: #f92672">:</span> <span style="color: #a6e22e">srcDir</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
              <div class="ac-caption">blanketWrapper.js</div>

              <p align="justify">
                Last but not least, the <i>src</i> option. This one will define where <b>Mocha</b> can find the test code
                to be executed.
              </p>

              <p align="justify">
                The <i>coverage</i> sub-task is defining how we will report the test status. Inside <i>options</i> we defined
                that we will report in a coverage html template by <b>reporter: 'html-cov'</b>, quietly (meaning that
                <b>Blanket</b> should not print <b>Mocha</b>'s output into this file and the name of this coverage file
                should be <i>coverage.html</i>. We told <b>Blanket</b> where to find the test files too.
              </p>

              <header>
                <h4>Writing Tests</h4>
              </header>

              <p align="justify">
                Now for the test file. We will use our Dog Service from <a href="/acbook-nodejs/lecture3.html#one">Lecture 3: Middleware</a>.
                We have three endpoints:
              </p>

              <ul>
                <li>http://localhost:8080/dog</li>
                <li>http://localhost:8080/goodDog</li>
                <li>http://localhost:8080/wiggle</li>
              </ul>

              <!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #e6db74">&#39;use strict&#39;</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">const</span> <span style="color: #a6e22e">supertest</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;supertest&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">const</span> <span style="color: #a6e22e">should</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">let</span> <span style="color: #a6e22e">dogData</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">name</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;testDog&#39;</span>
  <span style="color: #f8f8f2">},</span>
  <span style="color: #a6e22e">updateDog</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">index</span><span style="color: #f92672">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span>
    <span style="color: #a6e22e">name</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;testDog2&#39;</span>
  <span style="color: #f8f8f2">};</span>

<span style="color: #a6e22e">describe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Dog Service&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">let</span> <span style="color: #a6e22e">url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;http://localhost:8080&#39;</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">let</span> <span style="color: #a6e22e">request</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">supertest</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">url</span><span style="color: #f8f8f2">);</span>

  <span style="color: #a6e22e">describe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span> <span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">it</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should create a dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">done</span><span style="color: #f8f8f2">){</span>
      <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog&#39;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogData</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">expect</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">201</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">});</span>

      <span style="color: #a6e22e">it</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should update the test dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">done</span><span style="color: #f8f8f2">){</span>
        <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">put</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog&#39;</span><span style="color: #f8f8f2">)</span>
          <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">updateDog</span><span style="color: #f8f8f2">)</span>
          <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">expect</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">});</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">describe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog/:doggyId&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span> <span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #a6e22e">it</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should delete the first dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">done</span><span style="color: #f8f8f2">){</span>
      <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog/0&#39;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">expect</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">end</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
          <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">);</span>

          <span style="color: #66d9ef">let</span> <span style="color: #a6e22e">dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">not</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">empty</span><span style="color: #f8f8f2">;</span>

          <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">();</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">});</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">describe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/wiggle/:doggyId&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span> <span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #a6e22e">it</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should wiggle the first dog\&#39;s tail&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">done</span><span style="color: #f8f8f2">){</span>
      <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/wiggle/0&#39;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">expect</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">end</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
          <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">);</span>

          <span style="color: #66d9ef">let</span> <span style="color: #a6e22e">dogWiggle</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>

          <span style="color: #a6e22e">dogWiggle</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">not</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">empty</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">dogWiggle</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">msg</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">not</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">empty</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">dogWiggle</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">msg</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">an</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">instanceOf</span><span style="color: #f8f8f2">(String);</span>
          <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">()</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">});</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">describe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/goodDog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span> <span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #a6e22e">it</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;should say that the first dog is a good dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">done</span><span style="color: #f8f8f2">){</span>
      <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/goodDog/0&#39;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">expect</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">end</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
          <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">error</span><span style="color: #f8f8f2">);</span>

          <span style="color: #66d9ef">let</span> <span style="color: #a6e22e">goodDog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">goodDog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">not</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">empty</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">goodDog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">msg</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">not</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">empty</span><span style="color: #f8f8f2">;</span>
          <span style="color: #a6e22e">goodDog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">msg</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">should</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">be</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">an</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">instanceOf</span><span style="color: #f8f8f2">(String);</span>
          <span style="color: #a6e22e">done</span><span style="color: #f8f8f2">();</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">});</span>
  <span style="color: #f8f8f2">});</span>
<span style="color: #f8f8f2">});</span>
</pre></div>

              <div class="ac-caption">Test File For Dog Service</div>

              <p align="justify">
                WOW! That is huge! (That's what she said). But, wait a minute... its is readable! Yes sir! Using the power
                of this test stack we can use BDD do write our tests and anyone can understand what is going on! That is
                awesome!
              </p>

              <p align="justify">
                Ok, one step at a time. First lines are the imports that we need to run the tests, easy. Then we have some
                mock data to test everything. And next we have <b>describe()</b>. Ok, do not despair. We are only defining
                a scope. Inside this we can set up some configurations before and after our tests. For instance, we define
                the server URL that we are testing, bootstrap the <b>Supertest</b> library using <b>request(url);</b> and
                then we call <b>before()</b> and <b>after</b> methods.
              </p>

              <p align="justify">
                Those methods are defining what will happen before and after all the actual tests (We can define actions
                to be done before and after EACH test using <b>beforeEach()</b> and <b>afterEach()</b> respectively). And
                finally we define the tests.
              </p>

              <p align="justify">
                Each <b>it()</b> is a test defined. As we are testing APi calls we do not know when those will end. Therefore
                we tell mocha to give us a callback named <b>done</b> so we can call it when we finish testing the results
                that came with the request's response. And the rest is pretty readable! See for yourself, you literally
                read what the test is doing.
              </p>

              <p align="justify">
                Everything ready to be executed! Go running to your terminal en execute and type:
              </p>

              <!-- HTML generated using hilite.me -->
              <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span> <span style="color: #a6e22e">grunt</span> <span style="color: #a6e22e">testServer</span>
</pre></div>
              <div class="ac-caption">Executing Our Test Task</div>

              <p align="justify">
                Blanket has created a file with its report, take a look and see what it created for us.
              </p>

              <p align="justify">
                Please, there is no need to hold your tears of happiness, let it flow.
              </p>
            </div>
          </section>

          <!-- Six -->
          <section id="six">
            <div class="container">
              <header class="major">
                <h2>Exercises</h2>
              </header>

              <p align="justify">
                Keep using your code which you developed on <a href="lecture4.html#four">last lecture</a>
              </p>

              <header>
                <h4>Exercise 1:</h4>
              </header>

              <p align="justify">
                Using the server which you were working until now, create a Gulp task to use nodemon to run it.
              </p>

              <header>
                <h4>Exercise 2:</h4>
              </header>

              <p align="justify">
                Using the same code from last exercise create an API Tests for your routes (Using the same stack as shwon here).

                <ul>
                  <li>supertest</li>
                  <li>mocha</li>
                  <li>should</li>
                </ul>

                You might need to refector a thing or two, ;-)
              </p>

              <header>
                <h4>Exercise 3:</h4>
              </header>

              <p align="justify">
                Using the same code from last exercise create a task to run your test cases automatically.
              </p>

              <header>
                <h4>Exercise 4:</h4>
              </header>

              <p align="justify">
                Now, instead of running an API test (which is very expensive), create unit tests to test your controllers. This way
                you wont need to run your server to test your code.

                hint: maybe you will need to decouple your controllers from your route code.
              </p>

              <p align="justify">
                Now that you have these new unit tests, create a task to run them (keep you API test task)
              </p>

              <header>
                <h4>Exercise 8:</h4>
              </header>

              <p align="justify">
                <b>Challenge:</b> add a coverege report for your tests.

                Hint: <b>gulp coverage</b>
              </p>
            </div>
          </section>
        </div>

      <!-- Footer -->
      <section id="footer">
        <div class="container">
          <ul class="copyright">
            <li>&copy; Avenue Code. All rights reserved.</li>
            <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
          </ul>
        </div>
      </section>
		</div>
	</body>
</html>
